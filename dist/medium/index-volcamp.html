<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>Drogué à l&#8217;hexagone, Node JS ne m&#8217;a pas vraiment aidé à rester clean &#8230;&#8203;</title><link rel="stylesheet" href="/node_modules/reveal.js/css/reset.css"><link rel="stylesheet" href="/node_modules/reveal.js/css/reveal.css"><link rel="stylesheet" href="/node_modules/reveal.js/css/theme/league.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right {
  float: right
}

/* listing block */
.reveal .listingblock.stretch > .content {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre > code {
  height: 100%;
  max-height: 100%
}

/* tables */
table {
  border-collapse: collapse;
  border-spacing: 0
}

table {
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

td.tableblock > .content {
  margin-bottom: 1.25em
}

td.tableblock > .content > :last-child {
  margin-bottom: -1.25em
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0
}

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px
}

table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0
}

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot, table.frame-ends {
  border-width: 1px 0
}

.reveal table th.halign-left, .reveal table td.halign-left {
  text-align: left
}

.reveal table th.halign-right, .reveal table td.halign-right {
  text-align: right
}

.reveal table th.halign-center, .reveal table td.halign-center {
  text-align: center
}

.reveal table th.valign-top, .reveal table td.valign-top {
  vertical-align: top
}

.reveal table th.valign-bottom, .reveal table td.valign-bottom {
  vertical-align: bottom
}

.reveal table th.valign-middle, .reveal table td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  font-weight: bold
}

thead {
  display: table-header-group
}

.reveal table.grid-none th, .reveal table.grid-none td {
  border-bottom: 0 !important
}

/* kbd macro */
kbd {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .65em;
  line-height: 1.45;
  background: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: 0 .15em;
  padding: .2em .5em;
  vertical-align: middle;
  position: relative;
  top: -.1em;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

/* callouts */
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background: rgba(0, 0, 0, .8);
  -webkit-border-radius: 50%;
  border-radius: 50%;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

/* Callout list */
.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1, td.hdlist2 {
  vertical-align: top;
  padding: 0 .625em
}

td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em
}

/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child {
  padding: .4em .75em 0;
  line-height: 1;
  vertical-align: top
}

.colist td:not([class]):first-child img {
  max-width: none
}

.colist td:not([class]):last-child {
  padding: .25em 0
}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table {
  border: 0
}

/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist > table th, .reveal .colist > table td {
  border-bottom: 0
}

/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td {
  line-height: inherit
}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
}

.columns .slide-content > .column > * {
  padding: .75rem;
}

/* See #353 */
.columns.wrap .slide-content > .column {
  flex-basis: auto;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.footnotes {
  border-top: 1px solid rgba(0, 0, 0, 0.2);
  padding: 0.5em 0 0 0;
  font-size: 0.65em;
  margin-top: 4em;
}
</style><!--Printing and PDF exports--><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "/node_modules/reveal.js/css/print/pdf.css" : "/node_modules/reveal.js/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><link rel="stylesheet" href="style-volcamp.css"></head><body><div class="reveal"><div class="slides"><section class="title main-title background" data-state="title"><h1>Drogué à l&#8217;hexagone, Node JS ne m&#8217;a pas vraiment aidé à rester clean &#8230;&#8203;</h1><div class="preamble"><div class="paragraph"><p>Mais NestJS pourrait-il me sauver ?</p></div>
<div class="paragraph credits"><p>Nicolas Giraud (@nicgiro)</p></div>
<div class="paragraph instance"><p>Volcamp 2022</p></div>
<aside class="notes"><div class="ulist"><ul><li><p>Bonjour et bienvenue dans ce cercle de parole.
Nous accueillons aujourd&#8217;hui un nouveau membre.</p></li><li><p>Bonjour, moi c&#8217;est Nicolas, dis-je un peu timoré.</p></li><li><p>Bonjour Nicolas, repris mon auditoire</p></li><li><p>Alors Nicolas, est-ce que tu veux bien nous raconter ce qui t&#8217;amène ici ?</p></li></ul></div></aside></div></section>
<section><section id="_lhistoire" class="titre background"><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/walking-man.svg" alt="walking man" width="40%"></span></p></div><aside class="notes"><div class="paragraph"><p>Il y a quelques années, j&#8217;errais dans ma veille au gré des confs et des meetups, conscient que je pouvais faire des choses pour améliorer mon quotidien, et peut-être même celui de mes collègues&#8230;&#8203;</p></div></aside></div></section><section id="_mes_errances" class="histoire background"><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/millefeuille.jpg" alt="millefeuille" width="60%"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Très ancré dans des projets dont la segmentation des responsabilités en couches avait largement fait ses preuves, j&#8217;étais convaincu qu&#8217;on tenait là quelques choses d&#8217;aboutis, et qu&#8217;il fallait simplement former !</p></div></aside></div></section><section id="_la_lumière" class="histoire background"><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/postit.jpg" alt="postit"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Et puis en chemin, j&#8217;ai croisé le Domain Driven Design qui m&#8217;a un peu fait chanceler.</p></div>
<div class="ulist"><ul><li><p>Qui en a entendu parler ?</p></li><li><p>Qui connait <em>bien</em> ?</p></li><li><p>Qui le pratique ?</p></li></ul></div></aside></div></section><section id="_la_voie_du_craft" class="histoire background"><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/swcrafters-nantes.jpg" alt="swcrafters nantes"></span></p></div>
<aside class="notes"><div class="paragraph"><p>&#8658; Logo du meetup SWCrafters à Nantes, j&#8217;en profite je leur fait un peu de pub !</p></div>
<div class="paragraph"><p>J&#8217;ai plongé&#8230;&#8203; DDD, clean architecture, modèle hexagonale.
Alors ce n&#8217;est pas parfait, et je n&#8217;ai pas une pratique exemplaire, mais j&#8217;essaie&#8230;&#8203;
Pourquoi me direz-vous ?</p></div>
<div class="paragraph"><p>Sur le papier, ces concepts semblent répondre à pas mal de mes difficultés, et j&#8217;ai commencé à les expérimenter dans mon contexte technique, Java, principalement sur des API REST.</p></div></aside></div></section><section id="_mise_en_pratiques" class="moi background"><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/intervenants-nicolas.png" alt="intervenants nicolas" width="60%"></span></p></div>
<div class="paragraph"><p>Nicolas Giraud (@nicgiro)</p></div>
<aside class="notes"><div class="paragraph"><p>Le temps a passé et mes orientations DevOps m&#8217;ont conduites dans d&#8217;autres contextes&#8230;&#8203; La suite de cette histoire parle et part d&#8217;un outil que j&#8217;ai dû faire pour m&#8217;outiller !</p></div>
<div class="paragraph"><p>La suite du talk part de mon point de vue.<br>
Si je ne veux pas être jugé, je dois vous donner mon contexte pour vous aider à comprendre et à adapter mes conclusions à VOUS, à VOTRE contexte.</p></div></aside></div></section><section id="_un_client_dans_le_navigateur" class="histoire background" data-transition="fade-out"><h2>Un client dans le navigateur !</h2><div class="slide-content"><div class="paragraph fragment"><p><span class="image"><img src="./images/vue.svg" alt="vue" height="250em"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Au départ, un petit client, Vue3, pour aller taper les API de mes outils (Gitlab pour ne pas le citer).
Puis, la complexité augmentant et l&#8217;expertise manquant, le client à migré en Angular (pas de jugement SVP !!!).</p></div></aside></div></section><section id="_un_client_dans_le_navigateur_2" class="histoire background" data-transition="fade-in"><h2>Un client dans le navigateur !</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/angular-icon.svg" alt="angular icon" height="250em"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Au départ, un petit client, Vue3, pour aller taper les API de mes outils (Gitlab pour ne pas le citer).
Puis, la complexité augmentant et l&#8217;expertise manquant, le client à migré en Angular (pas de jugement SVP !!!).</p></div></aside></div></section><section id="_ajout_dun_backend" class="histoire background" data-transition="fade-out"><h2>Ajout d&#8217;un backend</h2><div class="slide-content"><div class="paragraph fragment"><p><span class="image"><img src="./images/spring.svg" alt="spring"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Mais rapidement, ce ne fut pas suffisant.
J&#8217;ai eu besoin d&#8217;un d&#8217;injecter des règles métiers, de centraliser de la donnée partagée par différents utilisateurs, et de réagir à des évènements extérieurs au navigateur.
Bref, il me fallait un backend.</p></div>
<div class="paragraph"><p>Rien de plus simple : springboot et c&#8217;est parti</p></div></aside></div></section><section id="_ajout_dun_backend_2" class="histoire background" data-transition="fade-in"><h2>Ajout d&#8217;un backend</h2><div class="slide-content"><div class="paragraph fragment"><p><span class="image"><img src="./images/nodejs-icon.svg" alt="nodejs icon"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Mais non, je vous l&#8217;ai dit, j&#8217;ai changé de contexte.
Ici, on fait beaucoup de Python, du Javascript, et du .Net. Et à nos heures perdue, du shell, powershell, et j&#8217;avais déja introduit du typescript avec Angular, et d&#8217;autres outils (mais c&#8217;est un autre sujet&#8230;&#8203;)</p></div>
<div class="paragraph"><p>NodeJs devient alors une évidence&#8230;&#8203; Chargé à bloque, j&#8217;ai tracé la route, franchis quelques cols, et pris quelques impasses&#8230;&#8203;</p></div></aside></div></section><section id="_mais_ca_ne_fait_que_commencer" class="histoire background"><h2>Mais ca ne fait que commencer !</h2><div class="slide-content"><aside class="notes"><div class="paragraph"><p>Mais surtout comme j&#8217;ai trouvé peu d&#8217;aide sur ces sujets(bon, j&#8217;ai peut être mal cherché&#8230;&#8203;), j&#8217;ai eu envie de vous partager cette aventure&#8230;&#8203;</p></div>
<div class="paragraph"><p><strong>5 mins</strong></p></div></aside></div></section></section>
<section><section id="_mais_de_quoi_parle_t_on_exactement" class="titre background"><h2>Mais de quoi parle-t-on exactement ?</h2><div class="slide-content"><div class="imageblock"><img src="./images/man_write.svg" alt="man write" width="40%"></div><aside class="notes"><div class="paragraph"><p>Attendez, je sens que tout le monde n&#8217;a pas le même vocabulaire&#8230;&#8203;
On va repartir sur l vocabulaire pour être sûr que tout le monde a les mêmes bases.
Comme ça, je pourrais vous expliciter ce que j&#8217;ai voulu faire</p></div></aside></div></section><section id="_un_domain_unique" class="vocabulaire background"><div class="slide-content"><div class="imageblock"><img src="./images/hexa-domain.png" alt="hexa domain" width="30%"></div>
<aside class="notes"><div class="paragraph"><p>Revenons sur cette notion de modèle hexagonal, voir de DDD.
Le principe, dumoins quand on se contente de le dessiner, est relativement simple.</p></div>
<div class="paragraph"><p>On va considérer un ensemble d&#8217;objets/fonctions/méthode qu&#8217;on va appeler  domaine (métier)! Et on va essayer de suivre trois règles :</p></div>
<div class="ulist"><ul><li><p>Toute chose dans ce domaine est nommée selon le vocabulaire utilisé par le métier</p></li><li><p>Toutes les règles et interactions entre ces données sont implémentées ici</p></li><li><p>Aucun élément technique n&#8217;existe dans ce domaine</p></li></ul></div></aside></div></section><section id="_des_sources_de_données" class="vocabulaire background"><div class="slide-content"><div class="imageblock"><img src="./images/hexa-domain-spi.png" alt="hexa domain spi" width="60%"></div>
<aside class="notes"><div class="paragraph"><p>On va ensuite identifier ses sources de données (base, api externes, etc).
Les positionner à l&#8217;extérieur.
Le domaine va décider quels sont ses besoins (interfaces) dans son langage (modèle métier) et demander à ses sources de donner de se débrouiller pour implémenter les fonctionnalités techniques.</p></div>
<div class="paragraph"><p>WARN: On peut considérer ces SPI comme un même ensemble, le métier n&#8217;ayant pas lieu de connaitre la source de la donnée qu&#8217;il manipule.</p></div></aside></div></section><section id="_et_on_expose" class="vocabulaire background"><div class="slide-content"><div class="imageblock"><img src="./images/hexa-domain-api.png" alt="hexa domain api" width="60%"></div>
<aside class="notes"><div class="paragraph"><p>Enfin le domaine va exposer des méthodes pour interagir avec lui. Autrement dit, une interface qu&#8217;il va implémenter, et qui pourra être consommé au travers de controller REST.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Je n&#8217;ai pas utilisé le terme API REST pour éviter les confusions.</td></tr></table></div></aside></div></section><section id="_isolation_forte" class="vocabulaire background"><div class="slide-content"><div class="imageblock"><img src="./images/hexa-all.png" alt="hexa all" width="100%"></div>
<aside class="notes"><div class="paragraph"><p>Et normalement là, on commence à voir l&#8217;hexagone se dessiner.
L&#8217;un des intérêts de ceci est que si on sépare correctement les composants de notre application, des développeurs qui ne maitriseraient pas ou peu ce type d&#8217;architecture pourraient faire évoluer l&#8217;application sans trop d&#8217;erreur.</p></div></aside></div></section><section id="_par_inversion_de_controle" class="vocabulaire background"><div class="slide-content"><div class="imageblock"><img src="./images/hexa-focus-invers.png" alt="hexa focus invers" width="100%"></div>
<aside class="notes"><div class="paragraph"><p>Regardons quand même un peu plus près une des relations entre le domaine et un ressource de données.</p></div>
<div class="paragraph"><p>Ici, votre domaine va manipuler des interfaces (signature de fonctions). définies dans le(s) composant(s) SPI.
Un composant technique (Base de données) qui va implémenter les méthodes du SPI. Ce concept est appelé inversion de contôle.</p></div>
<div class="paragraph"><p>Au runtime, on aura une injection de dépendance qui va associer une implémentation à l&#8217;interface pour servir le domaine.</p></div></aside></div></section><section id="_en_synthèse" class="synthese background"><div class="slide-content"><div class="imageblock"><img src="./images/all-synthese.png" alt="all synthese" width="60%"></div>
<aside class="notes"><div class="paragraph"><p>En plus de la notion de domaine, on va se focalise sur 3 concepts importants pour la suite :</p></div>
<div class="ulist"><ul><li><p>L&#8217;injection de dépendances</p></li><li><p>L&#8217;inversion de contrôle</p></li><li><p>Isolation des composants</p></li></ul></div></aside></div></section><section id="_et_cest_parti" class="histoire background"><h2>Et c&#8217;est parti.</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/typescript-icon.svg" alt="typescript icon"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Donc on est partis !
Typescript, un petit express pour exposer les endpoints rest, plus qu&#8217;à trouver une librairie pour assurer l&#8217;injection de dépendance, une autre pour l&#8217;inversion de contrôle et le tour est (presque) joué.</p></div>
<div class="paragraph"><p>A ce stade, j&#8217;ai la profonde conviction que la plus grosse difficulté serait la modularisation de l&#8217;application, mais je mets ce point de coté pour le moment&#8230;&#8203;</p></div></aside></div></section><section id="_disclaimer" class="attention background"><h2>Disclaimer</h2><div class="slide-content"><aside class="notes"><div class="paragraph"><p>Petite précision quand même.
Je vous ai dit que je n&#8217;étais pas un dogmatique.
Et dans ce sens, je vais probablement m&#8217;autoriser quelques petits coups de canif dans le contrat du domaine !
Surtout, si vous n&#8217;êtes pas d&#8217;accord, si vous avez une meilleure méthode, n&#8217;hésitez pas à venir en parler&#8230;&#8203; C&#8217;est en échangeant sur nos pratiques qu&#8217;on apprend !!!</p></div>
<div class="paragraph"><p><strong>10 mins</strong></p></div></aside></div></section></section>
<section><section id="_dans_les_entrailles_de_typescript" class="titre background"><h2>Dans les entrailles de Typescript</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/man_sit.svg" alt="man sit" width="40%"></span></p></div><aside class="notes"><div class="paragraph"><p>Commencons par regarder les éléments natifs au langage&#8230;&#8203;</p></div>
<div class="paragraph"><p>On va parler modèle, Programmation Orienté Objet et Interface.</p></div></aside></div></section><section id="_définir_son_modèle" class="existant background" data-state="code"><h2>Définir son modèle</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-lang="typescript">//Endpoint
interface RestUser {
    name: string
    lastname: string
}

//Domain
interface User {
    name: string
    lastname: string
    birthDate: Date
}

//Databases
interface DataUser {
    version: number
    name: string
    lastname: string
    birthDate: Date
}</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Une des pratiques en TypeScript consiste à définir son modèle de données sous forme d&#8217;interface. Cette méthode est particulièrement pratique pour  limiter les mappings tout en s&#8217;assurant que les objets transitant entre les modules possèdent les attributs attendus.</p></div></aside></div></section><section id="_transmission" class="existant background" data-transition="fade-out" data-state="code"><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="3,4,5,6|14,15,16|25,26,27|14,15,16|3,4,5,6|8" data-lang="typescript">class UserEndpoint {
    service = new UserService()
    get(user: login): RestUser {
        return this.service.readUser(login)
    }

    post(user: RestUser): RestUser {
        return this.service.writeUser(user)
    }
}

class UserService {
    repository = new UserRepository()
    readUser(login: string): User {
        return this.repository.read(login)
    }

    writeUser(user: User): User {
        return this.repository.write(user)
    }
}

class UserRepository {
    database = new UserRepository()
    read(login: string): User {
        return {} as DataUser
    }

    write(user: User): User {
        return  {} as DataUser
    }
}</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Quand on va vouloir l&#8217;utiliser, tout va bien se passer&#8230;&#8203;</p></div>
<div class="paragraph"><p>Sauf que nous avons là deux problèmes.</p></div>
<div class="paragraph"><p>Le premier est que quand vous renvoyez un objet mongoDB au travers vos modules jusqu&#8217;au endpoint REST, vous transiter potentiellement par le réseau des données que vous ne souhaitez pas. Au hasard des identifiants techniques, ou tout autre éléments présents dans votre base que vous ne voulez pas voir en sortir&#8230;&#8203; (last update, version).</p></div>
<div class="paragraph"><p>Ceci dit, ici, on a une ligne qui ne compile pas !
Et c&#8217;est normal, il manque un attribut à RestUser pour apeller le User "Domain"</p></div></aside></div></section><section id="_oui_mais" class="attention background" data-transition="fade-in" data-state="code"><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="8" data-lang="typescript">class UserEndpoint {
    service = new UserService()
    get(user: string): RestUser {
        return this.service.readUser(user)
    }

    post(user: RestUser): RestUser {
        return this.service.writeUser(user as User)
    }
}

class UserService {
    repository = new UserRepository()
    readUser(login: string): User {
        return this.repository.read(login)
    }

    writeUser(user: User): User {
        return this.repository.write(user)
    }
}

class UserRepository {
    database = new UserRepository()
    read(login: string): User {
        return {} as DataUser
    }

    write(user: User): User {
        return  {} as DataUser
    }
}</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Le second est que si votre client est aussi du JS (ou TS), répondant aux mêmes pratiques (interfaces), s&#8217;il met à jour l&#8217;objet, il y a fort à parier qu&#8217;il vous demande une mise à jour avec TOUS les champs que vous avez envoyés sans en avoir l&#8217;intention !</p></div></aside></div></section><section id="_un_petit_de_tricks" class="astuce background" data-state="code"><h2>Un petit de tricks&#8230;&#8203;</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="4|5,6,7|8" data-lang="typescript">export class TrophyPlayerMapper {
  convertTo(trophyPlayerData: TrophyPlayerData) {
    if (!!trophyPlayerData) {
      return TrophyPlayer.getBuilder().
        .with('id', trophyPlayerData.id)
        .with('type', trophyPlayerData.type)
        .with('code', trophyPlayerData.code)
        .build()
    } else {
      return trophyPlayerData
    }
  }
}</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>On a des interfaces, donc pas de constructeur, on construit nos objets à la volée.
On a des mappers peu élégants.</p></div>
<div class="paragraph"><p>On peut cependant faire des choses assez étrange voir un poil piquante mais qui peuvent nous aider pour la suite.</p></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">Sample Builder</td></tr></table></div></aside></div></section><section id="_qui_pique" class="astuce background" data-state="code"><h2>&#8230;&#8203; qui pique !</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-lang="typescript">export class ObjectBuilder&lt;Target, Supplied&gt; {
  constructor(private target: Partial&lt;Target&gt;) {}

  with&lt;T extends Omit&lt;Target, keyof Supplied&gt;, K extends keyof T&gt;(key: K, value: T[K]) {
    const target: Partial&lt;Target&gt; = { ...this.target, [key]: value }

    return new ObjectBuilder&lt;Target, Supplied &amp; Pick&lt;T, K&gt;&gt;(target)
  }

  build() {
    return this.target as Target
  }
}</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>On peut cependant faire des choses assez étrange voir un poil piquante mais qui peuvent nous aider pour la suite.</p></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">Sample Builder</td></tr></table></div></aside></div></section><section id="_vous_avez_dit_bizarre" class="existant background" data-state="code"><h2>Vous avez dit bizarre ?</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Types : any, unknown, void</p></li><li class="fragment"><p>Valeurs : null, undefined</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Autre difficulté de typescript, les différentes valeurs bizarres : undefined, null, unknown, void, any.
Je ne vais pas entrer dans les détails ici, mais si vous êtes issu du monde .Net, Java, PHP (et j&#8217;en oublie) ces différents types ne vont pas vous apparaitre triviaux.</p></div></aside></div></section><section id="_un_des_effets_de_la_transpilation" class="existant background" data-state="explication"><h2>Un des effets de la transpilation</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-lang="typescript">export interface MessagesService {
    success: (message: MessageKey, broadcast: boolean, params?: any) =&gt; void
    error: (message: MessageKey, broadcast: boolean, params?: any) =&gt; void
    info: (message: MessageKey, broadcast: boolean, params?: any) =&gt; void
}

export class MessagesServiceImpl implements MessagesService {

    success(message: MessageKey, broadcast: boolean = true, params?: any) {
        //...
    }

    error(message: MessageKey, broadcast: boolean = true, params?: any) {
        //...
    }

    info(message: MessageKey, broadcast: boolean = true, params?: any) {
        //...
    }
}</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Les interfaces disparaissent à la transpilation</p></li></ul></div>
<div class="paragraph"><p>&#8658; on en reparle !!!</p></div></aside></div></section><section id="_alors_nodejs" class="synthese background"><h2>Alors NodeJS ?</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/nodejs-icon.svg" alt="nodejs icon" width="20%"></span></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>Différences comparatives aux autres languages</p></li><li><p>Faiblesse de la flexibilité induite par les modèles</p></li></ul></div>
<div class="paragraph"><p>&#8658; On est d&#8217;accord, rien de rédhibitoire, mais des points d&#8217;attention dont on se serait passé !</p></div>
<div class="paragraph"><p><strong>20 mins</strong></p></div></aside></div></section></section>
<section><section id="_injection_de_dépendance" class="titre background"><h2>Injection de dépendance</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/injection.svg" alt="injection" width="25%"></span></p></div><aside class="notes"><div class="paragraph"><p>Nous avons parlé du langage, maintenant allons un peu plus loin.
Regardons dans l&#8217;écosystème JS/TS les librairies qui peuvents tous aider.</p></div>
<div class="paragraph"><p>Le premier sujet est l&#8217;injection de dépendance&#8230;&#8203;</p></div>
<div class="paragraph"><p>Ce point consiste à définir des objets qui seront instanciés par le système au moment de leur utilisation. Selon les contextes ces objets peuvent avoir des portées différentes, basiquement : application (singleton), session (contexte utilisateur) ou requête (éphémère).</p></div></aside></div></section><section id="_typedi" class="injection background"><h2>TypeDI</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/typedi.png" alt="typedi"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Une des librairies les plus populaires dans le monde Node JS est TypeDI.
Je teste, galère, réussi à injecter dans mes différents modules !</p></div></aside></div></section><section id="_mise_en_place" class="injection background" data-state="code"><h2>Mise en place</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1|8|10,11,12|15|1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17" data-lang="typescript">@Service()
class UsersService {
    getUserByEmailWithPassword(email: string) {
        return ...
    }
}

@Service()
class UsersController {
    constructor(
        public usersService: UsersService
    ) {}

    listUsers() {
        return this.usersService.getUserByEmailWithPassword('mail');
    }
}</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>@Service &#8658; déclaration de présence dans le context (+ définition du scope)</p></li><li><p>Constructuer &#8658; pas de new</p></li><li><p>Identique à Angular.</p></li></ul></div></aside></div></section><section id="_configuration" class="injection background" data-state="code"><h2>Configuration</h2><div class="slide-content"><div class="listingblock"><div class="title">main.ts</div><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-lang="typescript">import 'reflect-metadata';</code></pre></div></div>
<div class="listingblock fragment"><div class="title">tsconfig.json</div><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{
  //...
  "compilerOptions": {
      //...
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true
      //...
  }
  //...
}</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Deux petites config</p><div class="ulist"><ul><li><p>Main de votre application</p></li><li><p>tsconfigs</p></li></ul></div></li></ul></div></aside></div></section></section>
<section><section id="_inversion_de_contrôle" class="titre background"><h2>Inversion de contrôle</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/inversion.svg" alt="inversion" width="25%"></span></p></div><aside class="notes"><div class="paragraph"><p>Passons à l&#8217;inversion de contrôle&#8230;&#8203;</p></div></aside></div></section><section id="_objectif" class="inversion background" data-state="code"><h2>Objectif</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3|6|14,15,16,17,18,19,20" data-lang="typescript">interface UsersInterface {
    getUserByEmail: (email: string) =&gt; Promise&lt;User&gt;;
}

@Service()
class UsersService implements UsersInterface  {
    getUserByEmail(email: string) {
        return ...
    }
}

@Service()
class UsersController {
    constructor(
        public usersInterface: UsersInterface
    ) {}

    getMe(email: string) {
        return this.usersInterface.getUserByEmail(email);
    }
}</code></pre></div></div></div></section><section id="_inversify" class="inversion background"><h2>Inversify</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/inversify.png" alt="inversify" width="20%"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Je poursuis mes recherches de librairie et je trouve Inversify qui semble répondre au besoin.</p></div>
<div class="paragraph"><p>On regarde comment ça fonctionne&#8230;&#8203;</p></div>
<div class="paragraph"><p>La première tentative est assez infructueuse, et pour cause&#8230;&#8203;
Intégrer Inversify dans ma structure n&#8217;était simplement pas pertinent pour la simple raison qu&#8217;il a strictement le même périmètere que TypeDI.
C&#8217;est un peu comme si, en Java, vous essayer d&#8217;avoir un contexte Spring dans un écosystème CDI de JavaEE!
(C&#8217;est possible, ce n&#8217;est pas fait pour, et ça marche entre mal et très mal !)</p></div>
<div class="paragraph"><p>Parce que oui, malgré leurs noms TypeDI gère aussi l&#8217;inversion de contrôle, et Inversify, l&#8217;injection de dépendance !</p></div></aside></div></section><section id="_mise_en_place_2" class="inversion background" data-state="code"><div class="slide-content"><div class="listingblock"><div class="title">Interface</div><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-lang="typescript">interface UsersService {
    getUserByEmail: (email: string) =&gt; Promise&lt;User&gt;;
}</code></pre></div></div>
<div class="listingblock fragment"><div class="title">Implémentation</div><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7|1" data-lang="typescript">@injectable()
class UsersServiceImpl implements UsersService {

    getUserByEmail(email: string) {
        return ...
    }
}</code></pre></div></div>
<div class="listingblock fragment"><div class="title">Endpoint</div><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="3|7|13|7" data-lang="typescript">import {interfaces} from "inversify-express-utils";

@injectable()
class UsersController implements interfaces.Controller {

    constructor(
        @Inject(SERVICES.Users) private readonly userService: UsersService
    ) {}

    @Get()
    @HttpCode(200)
    getMe(email: string) {
        return this.userService.getUserByEmail(email);
    }
}</code></pre></div></div></div></section><section id="_définition_des_implémentations" class="inversion background" data-state="code"><h2>Définition des implémentations</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-lang="typescript">const SERVICES = {
    Users: Symbol.for("UsersServiceImpl")
}</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Bref, l&#8217;un ou l&#8217;autre sont utilisables, mais la complexité technique pour ajouter un service m&#8217;a rapidement filé des boutons !
Désolé pour le nouveau parallèle Java, mais c&#8217;est un peu comme configurer spring en XML &#8230;&#8203;</p></div></aside></div></section><section id="_un_contexte_pour_les_gouverner_tous" class="attention background"><h2>Un contexte pour les gouverner tous&#8230;&#8203;</h2><div class="slide-content"><aside class="notes"><div class="paragraph"><p>La première tentative est assez infructueuse, et pour cause&#8230;&#8203;
Intégrer Inversify dans ma structure n&#8217;était simplement pas pertinent pour la simple raison qu&#8217;il a strictement le même périmètere que TypeDI.
C&#8217;est un peu comme si, en Java, vous essayer d&#8217;avoir un contexte Spring dans un écosystème CDI de JavaEE!
(C&#8217;est possible, ce n&#8217;est pas fait pour, et ça marche entre mal et très mal !)</p></div>
<div class="paragraph"><p>Parce que oui, malgré leurs noms TypeDI gère aussi l&#8217;inversion de contrôle, et Inversify, l&#8217;injection de dépendance !</p></div></aside></div></section><section id="_et_au_détour_dun_tunnel" class="victoire background" data-state="code"><h2>Et au détour d&#8217;un tunnel &#8230;&#8203;</h2><div class="slide-content"><div class="paragraph"><p>&#8230;&#8203;la lumière !</p></div>
<aside class="notes"><div class="paragraph"><p>Et là &#8230;&#8203; Nest JS à croisé mon chemin !</p></div>
<div style="page-break-after: always;"></div>
<div class="paragraph"><p>Alors je sais que vous attendez tous de savoir comment NestJS à répondu à mes problématiques&#8230;&#8203;
Mais comme j&#8217;ai envie de finir cette présentation sur une note positive, je vais avant vous exposer deux autres problématiques, soit que je n&#8217;ai pu résoudre, soit où la solution ne me plait pas complètement.
<strong>30 mins</strong></p></div></aside></div></section></section>
<section><section id="_lisolation" class="titre background"><h2>L&#8217;isolation&#8230;&#8203;</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/isolation.svg" alt="isolation" width="25%"></span></p></div><aside class="notes"><div class="paragraph"><p>Un dernier point qui va vraiment m&#8217;intéresser dans l&#8217;organisation hexagonale et d&#8217;avoir un découpage strict des modules pour éviter les <em>fuites</em>.</p></div></aside></div></section><section id="_ca_marche_comment_ailleurs" class="isolation background"><h2>Ca marche comment ailleurs ?</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/hexa-focus-invers.png" alt="hexa focus invers" width="60%"></span></p></div>
<aside class="notes"><div class="paragraph"><p>En java et en C# les choses sont assez simples. Que vous utilisiez graddle, maven ou nuggets, il est très simple de construire des sous modules, de monter des dépendances, et d&#8217;en interdire d&#8217;autre. Moyennant que vous nous touchiez pas à vos dépendances, vous avez relativement protégé votre coœur métier.
Il vous faudra seulement ajouter un module chapeau qui viendra tout assembler pour que les injections fonctionnent.</p></div></aside></div></section><section id="_npm_et_ses_packages" class="isolation background"><h2>NPM et ses packages</h2><div class="slide-content"><aside class="notes"><div class="paragraph"><p>Avec NPM ce point est adressable, mais est beaucoup moins trivial.</p></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content"><a href="https://javascript.plainenglish.io/how-to-create-multi-module-nodejs-applications-9aff2d73dc17" class="bare">https://javascript.plainenglish.io/how-to-create-multi-module-nodejs-applications-9aff2d73dc17</a></td></tr></table></div></aside></div></section><section id="_les_workspaces" class="isolation background" data-state="code"><h2>Les workspaces</h2><div class="slide-content"><div class="listingblock"><div class="title">package.json (app)</div><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{
  //...
  "workspaces":[
    "app-models",
    "app-business-api",
    "app-business",
    "app-entrypoint"
  ]
  //...
}</code></pre></div></div></div></section><section id="_par_dépendances" class="isolation background" data-state="code"><div class="slide-content"><div class="listingblock"><div class="title">package.json (app-business)</div><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-line-numbers="10,11,12,13,14,15" data-lang="json">{
   "name":"app-business",
   "version":"1.0.0",
   "description":"Domaine métier",
   "devDependencies":{
      "@types/node":"^17.0.8",
      "ts-node":"^10.4.0",
      "typescript":"^4.5.4"
   },
   "dependencies":{
      "app-models":"../app-models",
      "app-business-api":"../app-business-api",
      "app-data-spi":"../app-data-spi",
      ... <b>(1)</b>
   }
}</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Autres dépendances minimales (pas d&#8217;éléments techniques dans le domaine)</p></li></ol></div></div></section><section id="_accès_data" class="isolation background" data-state="code"><div class="slide-content"><div class="listingblock"><div class="title">package.json (app-data)</div><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-line-numbers="10,11,12,13,14,15" data-lang="json">{
   "name":"app-data",
   "version":"1.0.0",
   "description":"Implémentation d'accès aux données dans Mongo",
   "devDependencies":{
      "@types/node":"^17.0.8",
      "ts-node":"^10.4.0",
      "typescript":"^4.5.4"
   },
   "dependencies":{
      "app-models":"../app-models",
      "app-data-spi":"../app-data-spi",
      "mongoose": "^6.2.8",
      ... <b>(1)</b>
   }
}</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Autres dépendances techniques pour votre module de base de données.</p></li></ol></div></div></section><section id="_et_on_assemble" class="isolation background" data-state="code"><div class="slide-content"><div class="listingblock"><div class="title">package.json (app-server)</div><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{
   "name":"app-server",
   "version":"1.0.0",
   "description":"Server app",
   "main":"src/app.ts",
   "scripts":{
      "start":"tsc src/app.ts --esModuleInterop &amp;&amp; node src/app.js"
   },
   "dependencies":{
      "express":"^4.17.2",
      "app-models":"../app-models",
      "app-business-api":"../app-business-api",
      "app-business":"../app-business",
      "app-data-spi":"../app-data-spi",
      "app-data":"../app-data",
      "app-entrypoint":"../app-entrypoint"

   }
}</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Je ne vais pas rentrer dans les détails ici,
mais sachez qu&#8217;en utilisant ces fonctionnalités de NPM,
il est possible d&#8217;isoler les modules les uns des autres.</p></div>
<div class="paragraph"><p><strong>35 mins</strong></p></div></aside></div></section></section>
<section><section id="_on_y_est" class="titre background"><h2>On y est&#8230;&#8203;</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/nestjs.svg" alt="nestjs"></span></p></div><aside class="notes"><div class="paragraph"><p>Et Nest dans tout ça ?</p></div>
<div class="paragraph"><p>Quand je tombe par hasard sur cet outil, j&#8217;identifie à peu près tout ce que je cherchais :</p></div>
<div class="ulist"><ul><li><p>Gestion Modulaire (on verra plus tard, mais cool)</p></li><li><p>Injection de dépendances</p></li><li><p>Inversion de contrôle</p></li></ul></div>
<div class="paragraph"><p>Et en plus j&#8217;ai :</p></div>
<div class="ulist"><ul><li><p>Endpoints par annotation (avec intégration swagger)</p></li><li><p>Gestion d&#8217;intercepteurs (logs)</p></li><li><p>Intégration de filtres (erreurs)</p></li></ul></div></aside></div></section><section id="_une_petite_injection" class="injection background" data-state="code"><h2>Une petite injection ?</h2><div class="slide-content"><aside class="notes"><div class="paragraph"><p>Les providers vons nous permettre d&#8217;assurer l&#8217;injection de dépendances.</p></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">sample</td></tr></table></div></aside>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7,8,9,10,11,12|1|9" data-lang="typescript">@Injectable()
export class UsersService  {
    constructor() {}
    ...
}

export class UtilisateursController {
    constructor(
        @Inject private readonly userService: UsersService
    ) {
    }
}</code></pre></div></div></div></section><section id="_et_hop_on_inverse" class="inversion background" data-state="code"><h2>Et hop, on inverse !</h2><div class="slide-content"><div class="listingblock fragment"><div class="title">endpoint.controller.ts</div><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16|13" data-lang="typescript">export interface UsersService {
    ...
}

@Injectable()
export class UsersServiceImpl implements UsersService {
    constructor() {}
    ...
}

export class UtilisateursController {
    constructor(
        @Inject('Users') private readonly userService: UsersService
    ) {}
}</code></pre></div></div>
<div class="listingblock fragment"><div class="title">business.module.ts</div><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6|3|4" data-lang="typescript">@Module({
    imports: [DataModule],
    providers: [ {provide: 'Users', useClass: UsersServiceImpl} ],
    exports: [ 'Users' ]
})
export class BusinessModule {}</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>En revanche, pour l&#8217;inversion de controle, il y a un peu plus de boilerplate.
Vous vous souvenez des interfaces qui disparaissent ? Ca empeche pour le moment l&#8217;injection au run&#8230;&#8203; Il va falloir expliciter !</p></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">sample</td></tr></table></div></aside></div></section><section id="_on_ne_sait_jamais" class="inversion background" data-state="code"><h2>On ne sait jamais &#8230;&#8203;</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-lang="typescript">export const SERVICES = {
    Users: 'users.service',
}</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="13|19,20" data-lang="typescript">export interface UsersService {
    ...
}

@Injectable()
export class UsersServiceImpl implements UsersService {
    constructor() {}
    ...
}

export class UtilisateursController {
    constructor(
        @Inject(SERVICES.Users) private readonly userService: UsersService
    ) {}
}

@Module({
    imports: [DataModule],
    providers: [ {provide: SERVICES.Users, useClass: UsersServiceImpl} ],
    exports: [ SERVICES.Users ]
})
export class BusinessModule {}</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Il est à noter que le fichier de constante évite de saisir des chaines à la main, et donc les fautes de frappe particulièrement pénible dans ce genre d&#8217;exercice.</p></div></aside></div></section><section id="_un_projet_multi_package" class="isolation background" data-state="code"><h2>Un projet multi-package</h2><div class="slide-content"><div class="paragraph"><p>Passage du mode <strong>Standard</strong> à <strong>Monorepo</strong>.</p></div>
<aside class="notes"><div class="paragraph"><p>Expérimentation encore en cours.<br>
Pas de feedback dessus pour le moment.<br>
J&#8217;espère avoir quelques choses en plus à raconter&#8230;&#8203;<br>
Mais quand on lit la doc, ca correspond complètement à ce que je souhaite faire.</p></div></aside></div></section><section id="_introduction_de_librairies" class="isolation background" data-state="code"><h2>Introduction de librairies</h2><div class="slide-content"><div class="listingblock"><div class="title">nest-cli.json</div><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30|4|9|11|21|10,11,12,13,14,15,16,17,18" data-lang="json">{
  "collection": "@nestjs/schematics",
  "sourceRoot": "src",
  "monorepo": true,
  "root": "main",
  "compilerOptions": {
    ...
  },
  "projects": {
    "business": {
      "type": "library",
      "root": "libs/app-business",
      "entryFile": "index",
      "sourceRoot": "libs/app-business/src",
      "compilerOptions": {
        ...
      }
    },
    ...
    "aggregator": {
      "type": "application",
      "root": "app/aggregator",
      "entryFile": "main",
      "sourceRoot": "app/aggregator/src",
      "compilerOptions": {
        ...
      }
    }
}</code></pre></div></div></div></section><section id="_et_une_configuration" class="isolation background" data-state="code"><h2>Et une configuration&#8230;&#8203;</h2><div class="slide-content"><div class="listingblock"><div class="title">tsconfig.json</div><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">"paths": {
    "@app/business": [
        "libs/app-business/src"
    ],
    "@app/business/*": [
        "libs/business/src/*"
    ]
}</code></pre></div></div></div></section><section id="_mais_nest_cest_plus_que_cela" class="astuce background" data-state="code"><h2>Mais Nest c&#8217;est plus que cela &#8230;&#8203;</h2></section><section id="_des_controllers" class="astuce background" data-state="code"><h2>Des controllers&#8230;&#8203;</h2><div class="slide-content"><div class="paragraph"><p>&#8230;&#8203;par annotation</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22|1|6,7|8|12,13|17,18" data-lang="typescript">@Controller('utilisateurs')
export class UtilisateursController {

    constructor() {}

    @Post()
    @Header('content-type', 'application/json')
    login(@Body("token") token: string) {
        ...
    }

    @Get('/:id')
    getUserById(@Param('id') id: string) {
        ...
    }

    @Put('/:id')
     put(@Param('id') id: string, @Body() body: User) {
        ...
    }

}</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>La gestion des endpoint intégré à Nest est basée sur <em>express</em>, un standard pour les API NodeJS.</p></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">Sample</td></tr></table></div></aside></div></section><section id="_et_documenté_sil_vous_plait" class="victoire background" data-state="code"><h2>Et documenté s&#8217;il vous plait !</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18|1|8,9,10,11,12|13,14|6" data-lang="typescript">import {DocumentBuilder, SwaggerModule} from "@nestjs/swagger";
...

async function bootstrap() {
    const app = await NestFactory.create(AppModule);
    app.setGlobalPrefix('api');

    const config = new DocumentBuilder()
        .setTitle('Board')
        .setDescription('Tableau de bord d\'aide au déploiement')
        .setVersion('1.0')
        .build();
    const document = SwaggerModule.createDocument(app, config);
    SwaggerModule.setup('api', app, document);
    //...
}

bootstrap();</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Et un petit swagger en bonus&#8230;&#8203;</p></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">sample</td></tr></table></div></aside></div></section><section id="_encapsuler_les_appels" class="astuce background" data-state="code"><h2>Encapsuler les appels</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7,8,9,10,11,12,13,14|1,2|5|6,7,8|9|10,11,12" data-lang="typescript">@Injectable()
export class LoggingInterceptor implements NestInterceptor {
    private readonly logger = new Logger(LoggingInterceptor.name);

    intercept(context: ExecutionContext, next: CallHandler): Observable&lt;any&gt; {
        const resuqestId = getNamespace("board")!.get('requestId')!;
        this.logger.debug(`${resuqestId} - Before...`);
        const now = Date.now();
        return next.handle()
            .pipe(
                tap(() =&gt; this.logger.log(`${resuqestId} - After... ${Date.now() - now}ms`)),
            );
    }
}</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Mes deux petits bonus résident dans la gestion native de filtres et de middleware (on retrouve ces derniers aussi dans express)</p></div>
<div class="paragraph"><p>&#8658; Interceptor</p></div></aside></div></section><section id="_encapsuler_les_appels_2" class="astuce background" data-state="code"><h2>Encapsuler les appels</h2><div class="slide-content"><div class="listingblock"><div class="title">main.ts</div><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7,8|4" data-lang="typescript">async function bootstrap() {
    const app = await NestFactory.create(AppModule);
    app.setGlobalPrefix('api');
    app.useGlobalInterceptors(new LoggingInterceptor());
    ...
}

bootstrap();</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Mes deux petits bonus résident dans la gestion native de filtres et de middleware (on retrouve ces derniers aussi dans express)</p></div></aside></div></section><section id="_intercepter_les_erreurs" class="astuce background" data-state="code"><h2>Intercepter les erreurs&#8230;&#8203;</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26|1,2|10|16,17,18,19,20" data-lang="typescript">@Catch()
export class AllExceptionsFilter extends ExceptionsHandler
  protected httpAdapter: AbstractHttpAdapter

  constructor(httpAdapter: AbstractHttpAdapter)
    super()
    this.httpAdapter = httpAdapter
  }

  catch(exception: Error, host: ArgumentsHost) {
    const ctx: HttpArgumentsHost = host.switchToHttp()
    const response = ctx.getResponse()
    const url: string = this.httpAdapter.getRequestUrl(ctx.getRequest())
    const message: string = exception.message

    if (exception instanceof HttpException) {
      this.reply(response, exception.getStatus(), null, message, url)
    } else {
      this.reply(response, HttpStatus.INTERNAL_SERVER_ERROR, 'Internal Server Error', message, url)
    }
  }

  protected reply(response: Response, httpStatus: number, error: string, message: string, url: string) {
    const responseBody = { ... }
    this.httpAdapter.reply(response, responseBody, httpStatus)
}</code></pre></div></div>
<aside class="notes"><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">sample filter</td></tr></table></div></aside></div></section><section id="_intercepter_les_erreurs_2" class="astuce background" data-state="code"><h2>Intercepter les erreurs&#8230;&#8203;</h2><div class="slide-content"><div class="listingblock"><div class="title">main.ts</div><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7,8,9,10|5" data-lang="typescript">async function bootstrap() {
    const app = await NestFactory.create(AppModule);
    app.setGlobalPrefix('api');
    app.useGlobalInterceptors(new LoggingInterceptor());
    app.useGlobalFilters(new AllExceptionsFilter(httpAdapter))

    //...
}

bootstrap();</code></pre></div></div></div></section><section id="_attention_à_lasynchrone" class="attention background" data-state="code"><h2>Attention à l&#8217;asynchrone</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25|4,5,6,7,8,9|11,12,13,14,15,16|18,19,20,21,22,23" data-lang="typescript">@Injectable()
export class GameServiceImpl implements GameService {

  /* Retourne une promesse */
  getStats(bonus: number): Promise&lt;any&gt; {
    return this.resetCurrents()
      .then(() =&gt; this.statisticsRepository.readAll())
      .then((value) =&gt; this.stateService.setStatistics(value))
  }

  /* Fait une mise à jour en arrière plan - En cas d'erreur -&gt; NodeJS casse */
  bonusUnsafe(bonus: number): void {
    this.resetCurrents()
      .then(() =&gt; this.statisticsRepository.readAll())
      .then((value) =&gt; this.stateService.setStatistics(value))
  }

  /* Catch de l'erreur pour protéger le NodeJS. */
  bonus(bonus: number): void {
    this.resetCurrents()
      .then(() =&gt; this.statisticsRepository.readAll())
      .then((value) =&gt; this.stateService.setStatistics(value))
      .catch((error) =&gt; this.logger.error(`Error when change statistics: ${error.message}`))
  }
}</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Node est monothreder, et foncitonne par principe en asynchrone.
Avec le jeux des promises, et si on essai d&#8217;optimiser nos éléments, on peut se retrouver à poursuivre des traitements en arrière plan en randant la main à l&#8217;appelant.</p></div>
<div class="ulist"><ul><li><p>Encapsulation marche dans la requete</p></li><li><p>Si vous avec mis en asyncnhrone certaines actions, il ne faudra pas oublier les handlers</p></li></ul></div></aside></div></section><section id="_passer_des_informations" class="astuce background" data-state="code"><h2>Passer des informations</h2><div class="slide-content"><div class="paragraph"><p>Avec des middleware&#8230;&#8203;</p></div>
<aside class="notes"><div class="paragraph"><p><strong>Ce n&#8217;est pas du que du NestJS</strong></p></div>
<div class="paragraph"><p>Vous allez voir les middleware ont un comportement assez similaire avec les  intercepteurs</p></div>
<div class="paragraph"><p>Et le dernier Hack, une gestion équivalente à un theradlocal en Java.
Pour ceux qui ne connaiteraient pas ce principe, il s&#8217;agit au niveau endpoint de stocker les infos (user par example) dans un contexte contraint à la requête pour l&#8217;utiliser plus loin (base de donnée) sans avoir à la passer en paramètre de toutes vos fonctions !</p></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">sample</td></tr></table></div></aside>
<div class="listingblock fragment"><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28|1,2|3|10|4,5|6,7|17,18|23" data-lang="typescript">@Injectable()
export class TokenMiddleware implements NestMiddleware {
    use(request: any, response: any, next: () =&gt; void) {
        const ns = getNamespace("board")!;
        ns.run(() =&gt; {
            let requestId = randomUUID();
            ns.set("requestId", requestId);
            if (request.path === '/utilisateurs' &amp;&amp; request.method === 'POST') {
                this.logger.log(`${requestId} - URL non filtrée : Identification`)
                next()
            } else {
                /* Ne pas faire cela... c'est uniquement pour l'exemple ! */
                let session = request.header('PRIVATE-TOKEN')

                this.userService.readBySessionId(session)
                    .then(value =&gt; {
                        ns.set("token", value.token);
                        this.logger.debug(`${requestId} - Token positionné dans le namespace`)
                        next()
                    })
                    .catch(reason =&gt; {
                        this.logger.warn(`${requestId} - ${JSON.stringify(reason)}`)
                        response.status(404).send(`User's session ${session} not found`);
                    });
            }
        });
    }
}</code></pre></div></div></div></section><section id="_configurer_les_middlewares" class="astuce background" data-state="code"><h2>Configurer les middlewares</h2><div class="slide-content"><div class="listingblock"><div class="title">entrypoint.module.ts</div><div class="content"><pre class="highlightjs highlight"><code class="language-typescript hljs" data-noescape="true" data-line-numbers="1,2,3,4,5,6,7,8,9|6,7,8" data-lang="typescript">@Module({
    controllers: [...],
    imports: [...],
})
export class EntrypointModule implements NestModule {
    configure(consumer: MiddlewareConsumer) {
        consumer.apply(TokenMiddleware).forRoutes('');
    }
}</code></pre></div></div></div></section><section id="_interceptors_middlewares_et_filters" class="synthese background" data-state="code"><h2>Interceptors, middlewares et filters</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/nest-middle-filter-inter.png" alt="nest middle filter inter"></span></p></div>
<aside class="notes"><div class="paragraph"><p><strong>45 mins</strong></p></div></aside></div></section></section>
<section><section id="_une_belle_aventure" class="titre background"><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/man_zen.svg" alt="man zen" width="50%"></span></p></div><aside class="notes"><div class="paragraph"><p>Et voilà, l&#8217;aventure touche à sa fin&#8230;&#8203;</p></div>
<div class="paragraph"><p>Il est clair que ce voyage a été remplis de péripéties de toutes sortes, mais il y a plusieurs choses qui me semblent intéressante à en tirer.</p></div></aside></div></section><section id="_hexa_un_contexte_clean" class="synthese background"><h2>Hexa, un contexte clean ?</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/hexa-all.png" alt="hexa all"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Si le modèle hexagonal est empli de promesse auxquelles je crois fermement, il semble évident que le mettre en œuvre de facon strict tout en restant accessible au plus grand nombre n&#8217;est pas possible dans les écosystèmes.</p></div></aside></div></section><section id="_les_bons_outils" class="synthese background" data-transition="fade-out"><h2>Les bons outils</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/all-synthese-icon.png" alt="all synthese icon" width="60%"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Typescript n&#8217;est peut-être pas le meilleur écosystème pour mettre en place votre première architecture hexagonale, mais hormis les limitations du langage lui-même, les outils sont là pour répondre aux concepts !</p></div>
<div class="paragraph"><p>Et NestJS est surement ma plus belle découverte dans ce périple&#8230;&#8203;</p></div></aside></div></section><section id="_les_bons_outils_2" class="synthese background" data-transition="fade"><h2>Les bons outils</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/all-synthese-js.png" alt="all synthese js" width="60%"></span></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>TypeDI / Inversify</p></li><li><p>NPM / Yarn</p></li></ul></div></aside></div></section><section id="_les_bons_outils_3" class="synthese background" data-transition="fade-in"><h2>Les bons outils</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/all-synthese-nest.png" alt="all synthese nest" width="60%"></span></p></div></div></section><section id="_un_vrai_cadre_de_travail" class="victoire background"><h2>Un vrai cadre de travail&#8230;&#8203;</h2><div class="slide-content"><div class="paragraph"><p><span class="image"><img src="./images/nestjs.svg" alt="nestjs"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Alors oui, ce n&#8217;est surement pas parfait, mais c&#8217;est clairement un réel cadre de travail (framework) pour développer des Endpoint REST rapidement, efficacement, et en limitant le boilerplate technique.
Le tout avec ou sans votre architecture applicative préférée&#8230;&#8203;</p></div></aside></div></section><section id="_et_si_cétait_à_refaire" class="astuce background"><h2>Et si c&#8217;était à refaire ?</h2><div class="slide-content"><div class="paragraph fragment"><p><span class="image"><img src="./images/mysterium.png" alt="mysterium" width="60%"></span></p></div>
<aside class="notes"><div class="paragraph"><p>Pour vous dire, j&#8217;ai du refaire un endpoint pour une application évènementiel, j&#8217;ai poussé notre groupe à nous lancer sur Nest.
Mon excuse était que comme on ne savait pas qui allait venir sur le projet, en faisant ca on ne se mettait à dos aucune communauté.</p></div>
<div class="paragraph"><p>Parce qu&#8217;étrangement, un dev PHP, JAVA ou .Net est pret à aller faire du TS en back (il en fait un peu en front !!!), mais ne fera pas de PHP si il fait du JAVA ou inversement !
Et en plus nos amis fronteux sont devenus fullstack le temps d&#8217;un projet !!!!</p></div>
<div class="paragraph"><p><strong>50 mins</strong></p></div></aside></div></section></section>
<section id="_drogué_à_lhexagone_node_js_ne_ma_pas_vraiment_aidé_à_rester_clean" class="end-title background"><h2>Drogué à l&#8217;hexagone, Node JS ne m&#8217;a pas vraiment aidé à rester clean &#8230;&#8203;</h2><div class="slide-content"><div class="paragraph"><p>Des questions ?<br>
Des remarques ?</p></div>
<div class="paragraph credits"><p>Nicolas Giraud (@nicgiro)</p></div>
<div class="paragraph instance"><p>Volcamp 2022</p></div>
<aside class="notes"></aside></div></section>
<section id="_références"><h2>Références</h2></section></div></div><script src="/node_modules/reveal.js/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: 'true',
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: false,
  // Push each slide change to the browser history. Implies `hash: true`
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Disables the default reveal.js slide layout so that you can use custom CSS layout
  disableLayout: false,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 30,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 0,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: '/node_modules/reveal.js/plugin/zoom-js/zoom.js', async: true },
      { src: '/node_modules/reveal.js/plugin/notes/notes.js', async: true }
  ],

  

});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(960, 700)
});</script><link rel="stylesheet" href="/node_modules/reveal.js/lib/css/monokai.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>

<script>

/* highlightjs-line-numbers.js 2.6.0 | (C) 2018 Yauheni Pakala | MIT License | github.com/wcoder/highlightjs-line-numbers.js */
/* Edited by Hakim for reveal.js; removed async timeout */
!function(n,e){"use strict";function t(){var n=e.createElement("style");n.type="text/css",n.innerHTML=g(".{0}{border-collapse:collapse}.{0} td{padding:0}.{1}:before{content:attr({2})}",[v,L,b]),e.getElementsByTagName("head")[0].appendChild(n)}function r(t){"interactive"===e.readyState||"complete"===e.readyState?i(t):n.addEventListener("DOMContentLoaded",function(){i(t)})}function i(t){try{var r=e.querySelectorAll("code.hljs,code.nohighlight");for(var i in r)r.hasOwnProperty(i)&&l(r[i],t)}catch(o){n.console.error("LineNumbers error: ",o)}}function l(n,e){"object"==typeof n&&f(function(){n.innerHTML=s(n,e)})}function o(n,e){if("string"==typeof n){var t=document.createElement("code");return t.innerHTML=n,s(t,e)}}function s(n,e){e=e||{singleLine:!1};var t=e.singleLine?0:1;return c(n),a(n.innerHTML,t)}function a(n,e){var t=u(n);if(""===t[t.length-1].trim()&&t.pop(),t.length>e){for(var r="",i=0,l=t.length;i<l;i++)r+=g('<tr><td class="{0}"><div class="{1} {2}" {3}="{5}"></div></td><td class="{4}"><div class="{1}">{6}</div></td></tr>',[j,m,L,b,p,i+1,t[i].length>0?t[i]:" "]);return g('<table class="{0}">{1}</table>',[v,r])}return n}function c(n){var e=n.childNodes;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];h(r.textContent)>0&&(r.childNodes.length>0?c(r):d(r.parentNode))}}function d(n){var e=n.className;if(/hljs-/.test(e)){for(var t=u(n.innerHTML),r=0,i="";r<t.length;r++){var l=t[r].length>0?t[r]:" ";i+=g('<span class="{0}">{1}</span>\n',[e,l])}n.innerHTML=i.trim()}}function u(n){return 0===n.length?[]:n.split(y)}function h(n){return(n.trim().match(y)||[]).length}function f(e){e()}function g(n,e){return n.replace(/{(\d+)}/g,function(n,t){return e[t]?e[t]:n})}var v="hljs-ln",m="hljs-ln-line",p="hljs-ln-code",j="hljs-ln-numbers",L="hljs-ln-n",b="data-line-number",y=/\r\n|\r|\n/g;n.hljs?(n.hljs.initLineNumbersOnLoad=r,n.hljs.lineNumbersBlock=l,n.hljs.lineNumbersValue=o,t()):n.console.error("highlight.js not detected!")}(window,document);

/**
 * This reveal.js plugin is wrapper around the highlight.js
 * syntax highlighting library.
 */
(function( root, factory ) {
  if (typeof define === 'function' && define.amd) {
    root.RevealHighlight = factory();
  } else if( typeof exports === 'object' ) {
    module.exports = factory();
  } else {
    // Browser globals (root is window)
    root.RevealHighlight = factory();
  }
}( this, function() {

  // Function to perform a better "data-trim" on code snippets
  // Will slice an indentation amount on each line of the snippet (amount based on the line having the lowest indentation length)
  function betterTrim(snippetEl) {
    // Helper functions
    function trimLeft(val) {
      // Adapted from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill
      return val.replace(/^[\s\uFEFF\xA0]+/g, '');
    }
    function trimLineBreaks(input) {
      var lines = input.split('\n');

      // Trim line-breaks from the beginning
      for (var i = 0; i < lines.length; i++) {
        if (lines[i].trim() === '') {
          lines.splice(i--, 1);
        } else break;
      }

      // Trim line-breaks from the end
      for (var i = lines.length-1; i >= 0; i--) {
        if (lines[i].trim() === '') {
          lines.splice(i, 1);
        } else break;
      }

      return lines.join('\n');
    }

    // Main function for betterTrim()
    return (function(snippetEl) {
      var content = trimLineBreaks(snippetEl.innerHTML);
      var lines = content.split('\n');
      // Calculate the minimum amount to remove on each line start of the snippet (can be 0)
      var pad = lines.reduce(function(acc, line) {
        if (line.length > 0 && trimLeft(line).length > 0 && acc > line.length - trimLeft(line).length) {
          return line.length - trimLeft(line).length;
        }
        return acc;
      }, Number.POSITIVE_INFINITY);
      // Slice each line with this amount
      return lines.map(function(line, index) {
        return line.slice(pad);
      })
        .join('\n');
    })(snippetEl);
  }

  var RevealHighlight = {

    HIGHLIGHT_STEP_DELIMITER: '|',
    HIGHLIGHT_LINE_DELIMITER: ',',
    HIGHLIGHT_LINE_RANGE_DELIMITER: '-',

    init: function() {

      // Read the plugin config options and provide fallbacks
      var config = Reveal.getConfig().highlight || {};
      config.highlightOnLoad = typeof config.highlightOnLoad === 'boolean' ? config.highlightOnLoad : true;
      config.escapeHTML = typeof config.escapeHTML === 'boolean' ? config.escapeHTML : true;

      [].slice.call( document.querySelectorAll( '.reveal pre code' ) ).forEach( function( block ) {

        // Trim whitespace if the "data-trim" attribute is present
        if( block.hasAttribute( 'data-trim' ) && typeof block.innerHTML.trim === 'function' ) {
          block.innerHTML = betterTrim( block );
        }

        // Escape HTML tags unless the "data-noescape" attrbute is present
        if( config.escapeHTML && !block.hasAttribute( 'data-noescape' )) {
          block.innerHTML = block.innerHTML.replace( /</g,"&lt;").replace(/>/g, '&gt;' );
        }

        // Re-highlight when focus is lost (for contenteditable code)
        block.addEventListener( 'focusout', function( event ) {
          hljs.highlightBlock( event.currentTarget );
        }, false );

        if( config.highlightOnLoad ) {
          RevealHighlight.highlightBlock( block );
        }
      } );

    },

    /**
     * Highlights a code block. If the <code> node has the
     * 'data-line-numbers' attribute we also generate slide
     * numbers.
     *
     * If the block contains multiple line highlight steps,
     * we clone the block and create a fragment for each step.
     */
    highlightBlock: function( block ) {

      hljs.highlightBlock( block );

      // Don't generate line numbers for empty code blocks
      if( block.innerHTML.trim().length === 0 ) return;

      if( block.hasAttribute( 'data-line-numbers' ) ) {
        hljs.lineNumbersBlock( block, { singleLine: true } );

        // If there is at least one highlight step, generate
        // fragments
        var highlightSteps = RevealHighlight.deserializeHighlightSteps( block.getAttribute( 'data-line-numbers' ) );
        if( highlightSteps.length > 1 ) {

          // If the original code block has a fragment-index,
          // each clone should follow in an incremental sequence
          var fragmentIndex = parseInt( block.getAttribute( 'data-fragment-index' ), 10 );
          if( typeof fragmentIndex !== 'number' || isNaN( fragmentIndex ) ) {
            fragmentIndex = null;
          }

          // Generate fragments for all steps except the original block
          highlightSteps.slice(1).forEach( function( highlight ) {

            var fragmentBlock = block.cloneNode( true );
            fragmentBlock.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlight ] ) );
            fragmentBlock.classList.add( 'fragment' );
            block.parentNode.appendChild( fragmentBlock );
            RevealHighlight.highlightLines( fragmentBlock );

            if( typeof fragmentIndex === 'number' ) {
              fragmentBlock.setAttribute( 'data-fragment-index', fragmentIndex );
              fragmentIndex += 1;
            }
            else {
              fragmentBlock.removeAttribute( 'data-fragment-index' );
            }

          } );

          block.removeAttribute( 'data-fragment-index' )
          block.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlightSteps[0] ] ) );

        }

        RevealHighlight.highlightLines( block );

      }

    },

    /**
     * Visually emphasize specific lines within a code block.
     * This only works on blocks with line numbering turned on.
     *
     * @param {HTMLElement} block a <code> block
     * @param {String} [linesToHighlight] The lines that should be
     * highlighted in this format:
     * "1" 		= highlights line 1
     * "2,5"	= highlights lines 2 & 5
     * "2,5-7"	= highlights lines 2, 5, 6 & 7
     */
    highlightLines: function( block, linesToHighlight ) {

      var highlightSteps = RevealHighlight.deserializeHighlightSteps( linesToHighlight || block.getAttribute( 'data-line-numbers' ) );

      if( highlightSteps.length ) {

        highlightSteps[0].forEach( function( highlight ) {

          var elementsToHighlight = [];

          // Highlight a range
          if( typeof highlight.end === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child(n+'+highlight.start+'):nth-child(-n+'+highlight.end+')' ) );
          }
          // Highlight a single line
          else if( typeof highlight.start === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child('+highlight.start+')' ) );
          }

          if( elementsToHighlight.length ) {
            elementsToHighlight.forEach( function( lineElement ) {
              lineElement.classList.add( 'highlight-line' );
            } );

            block.classList.add( 'has-highlights' );
          }

        } );

      }

    },

    /**
     * Parses and formats a user-defined string of line
     * numbers to highlight.
     *
     * @example
     * RevealHighlight.deserializeHighlightSteps( '1,2|3,5-10' )
     * // [
     * //   [ { start: 1 }, { start: 2 } ],
     * //   [ { start: 3 }, { start: 5, end: 10 } ]
     * // ]
     */
    deserializeHighlightSteps: function( highlightSteps ) {

      // Remove whitespace
      highlightSteps = highlightSteps.replace( /\s/g, '' );

      // Divide up our line number groups
      highlightSteps = highlightSteps.split( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

      return highlightSteps.map( function( highlights ) {

        return highlights.split( RevealHighlight.HIGHLIGHT_LINE_DELIMITER ).map( function( highlight ) {

          // Parse valid line numbers
          if( /^[\d-]+$/.test( highlight ) ) {

            highlight = highlight.split( RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER );

            var lineStart = parseInt( highlight[0], 10 ),
              lineEnd = parseInt( highlight[1], 10 );

            if( isNaN( lineEnd ) ) {
              return {
                start: lineStart
              };
            }
            else {
              return {
                start: lineStart,
                end: lineEnd
              };
            }

          }
          // If no line numbers are provided, no code will be highlighted
          else {

            return {};

          }

        } );

      } );

    },

    /**
     * Serializes parsed line number data into a string so
     * that we can store it in the DOM.
     */
    serializeHighlightSteps: function( highlightSteps ) {

      return highlightSteps.map( function( highlights ) {

        return highlights.map( function( highlight ) {

          // Line range
          if( typeof highlight.end === 'number' ) {
            return highlight.start + RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER + highlight.end;
          }
          // Single line
          else if( typeof highlight.start === 'number' ) {
            return highlight.start;
          }
          // All lines
          else {
            return '';
          }

        } ).join( RevealHighlight.HIGHLIGHT_LINE_DELIMITER );

      } ).join( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

    }

  }

  Reveal.registerPlugin( 'highlight', RevealHighlight );

  return RevealHighlight;

}));
        
hljs.initHighlightingOnLoad();
</script></body></html>